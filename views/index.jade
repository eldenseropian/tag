extends layout

mixin small-picture
  - var picSize = 225
  // img(src="public/images/instacat.jpeg" alt=":(" width="#{picSize}" height="#{picSize}")

mixin status
  table#status
    tbody
      tr
        td
          div 
            h2 START
          div#start Cat
        td
          div 
            h2 PREVIOUS
          div#previous -
        td
          div 
            h2 CURRENT
          div#current Cat
        td
          div 
            h2 END
          div#end Smith

mixin us
  div By Lily, Indy, Julia, and Danae at Hack@Brown

mixin picture-choices()
  table#picture-choices
    tbody
      tr
        td#pic1
          +small-picture()
        td#pic2
          +small-picture()
      tr
        td#pic3
          +small-picture()
        td#pic4
          +small-picture()

mixin tags
  td(valign="top")
    div.tag-title Tags:
    div.tags
      ul
        li never
        li gonna
        li give
        li you
        li up
        li never
        li gonna
        li let
        li you
        li down
        li never
        li gonna
        li run
        li around
        li and
        li hurt
        li you
        li never
        li gonna
        li make
        li you
        li cry
        li never
        li gonna
        li say
        li goodbye
        li never
        li gonna
        li run
        li and
        li hide
        li and
        li desert
        li you

mixin choose-picture
  table
    tbody
      tr
        td
          +picture-choices()
          +tags()
  +status()
  +us()
  
mixin choose-tag
  table
    tbody
      tr
        td
          - var picSize = 430
          img(src="public/images/instacat.jpeg" alt=":(" width="#{picSize}" height="#{picSize}")
        td
          +tags()
  +status()
  +us()
  
block content
  h1 
    span #tag
    span#help ?
  div#choose-picture.show
    +choose-picture()
  div#choose-tag.noshow
    +choose-tag()
  div#end.noshow

  script(type='text/javascript').
    function getPhotosArray(string) {
      return string.data;
    }

    function tagCompare(first, second){
      if (first.tags.length < second.tags.length){
        return 1;
      }
      else {
        return -1;
      }
    }

    function getMostTaggedPhotosArray(jason) {
      return jason.data.sort(tagCompare);
    }

    function getNextIndex(used){
      var nextNum = Math.floor(Math.random() * 20);
      while(nextNum in used){
        nextNum = Math.floor(Math.random() * 20);
      }
      used[nextNum] = true;
      return nextNum;
    }
    
    function toString(string) {
      var picSize = 225;
      console.log(string);
      var array = getPhotosArray(string);
      var myURLs = new Array();
      var used = new Object();
      for (i = 0; i < 4; i++){
        var nextIndex = getNextIndex(used);
        var firstPic = array[nextIndex];
        console.log(nextIndex);
        var images = firstPic.images;
        var lowRes = images.low_resolution;
        var url = lowRes.url;
        myURLs[i] = url;
      }
      console.log(url);
      $( '#pic1' ).html('<img src='+ myURLs[0] + ' alt=":(" width="'+ picSize + '" height="' + picSize + '"></img>');
      $( '#pic2' ).html('<img src='+ myURLs[1] + ' alt=":(" width="'+ picSize + '" height="' + picSize + '"></img>');
      $( '#pic3' ).html('<img src='+ myURLs[2] + ' alt=":(" width="'+ picSize + '" height="' + picSize + '"></img>');
      $( '#pic4' ).html('<img src='+ myURLs[3] + ' alt=":(" width="'+ picSize + '" height="' + picSize + '"></img>');
      console.log('string');
    }
    function search(tagName) {
      console.log('hiiii');
      url = 'https://api.instagram.com/v1/tags/' + tagName + '/media/recent?callback=?&client_id=68de522f648043ee922bcf14545cfa7a';
      $.getJSON(url, toString);
    }

   script(type='text/javascript').
    search('cats');

   script(src='/public/javascripts/getTags.js')
   script(type='text/javascript').
    function getStartAndEndTags() {
     var startAndEnd = getTags();
     console.log(startAndEnd);
     $( '#start' ).html(startAndEnd[0]);
     $( '#end' ).html(startAndEnd[1]);
    }
